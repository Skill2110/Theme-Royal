function refreshCart(){$("#cart-modal .modal-body").html('<div class="alert alert-info">'+LOADING_MSG+"...</div>");var a='<table class="table table-bordered">';a+="<thead>",a+="<tr>",a+="<th>"+CART_ITEM_NAME_MSG+"</th>",a+="<th>"+CART_ITEM_PRICE_MSG+"</th>",a+="<th>"+CART_ITEM_QUANTITY_MSG+"</th>",a+="<th>"+CART_ACTIONS_MSG+"</th>",a+="</tr>",a+="</thead>",a+="<tbody>",$.cookie.json=!0;var t=$.cookie("cart"),d=!1,e=0;for(var i in t)null!==t[i]&&(d=!0,a+='<tr data-item-id="'+t[i].item_id+'">',a+="<td>"+t[i].item_name+"</td>",a+="<td>"+t[i].item_price+"</td>",a+="<td>"+t[i].quantity+"</td>",a+='<td><a class="btn btn-danger remove-from-cart" data-item-id="'+t[i].item_id+'">Supprimer</a></td>',a+="</tr>",e+=parseFloat(t[i].item_price)*t[i].quantity);a+="</tbody>",a+="</div>",d?($("#cart-total-price").html(e),$("#buy-cart").attr("disabled",!1),$("#buy-cart").removeClass("disabled"),$("#cart-modal .modal-body").html(a)):($("#cart-total-price").html("0"),$("#buy-cart").attr("disabled",!0),$("#buy-cart").addClass("disabled"),$("#cart-modal .modal-body").html('<div class="alert alert-danger">'+CART_EMPTY_MSG+"</div>")),$(".remove-from-cart").unbind("click"),$(".remove-from-cart").click(function(a){a.preventDefault();var t=$.cookie("cart"),d=[],e=$(this).attr("data-item-id"),i=0;for(var l in t)null!==t[l]&&t[l].item_id!=e&&(d.push(t[l]),i+=parseFloat(t[l].item_price)*t[l].quantity);$.cookie("cart",d),d.length>0?($("#cart-total-price").html(i),$("#cart-modal .modal-body").find('tr[data-item-id="'+e+'"]').slideUp(150)):($("#buy-cart").attr("disabled",!0),$("#buy-cart").addClass("disabled"),$("#cart-total-price").html("0"),$("#cart-modal .modal-body").html('<div class="alert alert-danger">'+CART_EMPTY_MSG+"</div>")),d=void 0}),$("input[name='cart-voucher']").unbind("keyup"),$("input[name='cart-voucher']").on("keyup",function(a){var t=$('input[name="cart-voucher"]').val();if($("#cart-modal .modal-footer").find("#cart-total-price").html("<small>"+LOADING_MSG+"...</small>"),$("#cart-modal .modal-footer").find("#buy-cart").addClass("disabled").attr("disabled",!0),0==t.length){var d=0,e=$.cookie("cart");for(var i in e)r++,d+=e[i].item_price*e[i].quantity;$("#cart-modal .modal-footer").find("#buy-cart").removeClass("disabled").attr("disabled",!1),$("#cart-modal .modal-footer").find("#cart-total-price").html(d)}else{e=$.cookie("cart");var l="",o="",r=0;for(var i in e)r++,l+=e[i].item_id,o+=e[i].quantity,r<e.length&&(l+=",",o+=",");$.get(VOUCHER_CHECK_URL+t+"/"+l+"/"+o,function(a){void 0!==a.price&&$("#cart-modal .modal-footer").find("#cart-total-price").html(a.price),$("#cart-modal .modal-footer").find("#buy-cart").removeClass("disabled").attr("disabled",!1)})}})}$(".display-item").click(function(a){a.preventDefault();var t=$(this).attr("data-item-id"),d='<div class="alert alert-info">';d+=LOADING_MSG+"...",d+="</div>",$("#buy-modal .modal-body").html(d),$("#buy-modal").modal(),$.ajax({url:ITEM_GET_URL+t,type:"GET",dataType:"json",success:function(a){$("#buy-modal .modal-body").fadeOut(150,function(){if(a.statut){$(this).html(a.html).fadeIn("250");var d=a.item_infos;$.cookie.json=!0;var e=$.cookie("cart");for(var i in e)if(null!==e[i]&&e[i].item_id==t){$(this).find("button.add-to-cart").html(ADDED_TO_CART_MSG),$(this).find("button.add-to-cart").addClass("disabled"),$(this).find("button.add-to-cart").attr("disabled","disabled");break}$("input[name='quantity']").TouchSpin({min:0,max:100,step:1,decimals:0,boostat:5,maxboostedstep:10}),$("input[name='quantity']").unbind("change"),$("input[name='quantity']").on("change",function(a){var e=$('input[id="code-voucher"]').val();if(0==e.length){var i=d.price*$(this).val();$("#buy-modal .modal-body").find("#total-price").html(i)}else{var l=$(this).val();void 0==l&&(l=1),$.get(VOUCHER_CHECK_URL+e+"/"+t+"/"+l,function(a){void 0!==a.price&&$("#buy-modal .modal-body").find("#total-price").html(a.price)})}}),$('input[id="code-voucher"]').unbind("keyup"),$('input[id="code-voucher"]').keyup(function(a){$("#buy-modal .modal-footer").find("#total-price").html("<small>"+LOADING_MSG.substr(0,4)+"...</small>"),$("#buy-modal .modal-footer").find("#btn-buy").addClass("disabled").attr("disabled",!0);var e=$(this).val(),i=$("input[name='quantity']").val();if(void 0==i&&(i=1),e.length>0)$.get(VOUCHER_CHECK_URL+e+"/"+t+"/"+i,function(a){void 0!==a.price&&$("#buy-modal .modal-body").find("#total-price").html(a.price),$("#buy-modal .modal-footer").find("#btn-buy").removeClass("disabled").attr("disabled",!1)});else{var l=d.price*i;$("#buy-modal .modal-body").find("#total-price").html(l),$("#buy-modal .modal-footer").find("#btn-buy").removeClass("disabled").attr("disabled",!1)}}),$(".buy-item").unbind("click"),$(".buy-item").click(function(a){a.preventDefault();var t=$(this).attr("data-item-id"),d=$("input[name='quantity']").val();void 0==d&&(d=1);var e=$("#code-voucher").val();0==$("#buy-modal .modal-body").find("#ajax-msg").length&&$("#buy-modal .modal-body").prepend('<div id="ajax-msg"></div>'),$("#btn-buy").attr("disabled",!0),$("#btn-buy").addClass("disabled"),$("#buy-modal .modal-body").find("#ajax-msg").html('<div class="alert alert-info">'+LOADING_MSG+"...</div>").fadeIn("150");var i={};i.items=[{item_id:t,quantity:d}],i.code=e,i["data[_Token][key]"]=CSRF_TOKEN,$.ajax({url:BUY_URL,data:i,type:"post",dataType:"JSON",success:function(a){a.statut?($("#btn-buy").attr("disabled",!1),$("#btn-buy").removeClass("disabled"),$("#buy-modal .modal-body").find("#ajax-msg").html('<div class="alert alert-success">'+a.msg+"</div>").fadeIn("150")):($("#btn-buy").attr("disabled",!1),$("#btn-buy").removeClass("disabled"),$("#buy-modal .modal-body").find("#ajax-msg").html('<div class="alert alert-danger">'+a.msg+"</div>").fadeIn("150"))},error:function(a){$("#btn-buy").attr("disabled",!1),$("#btn-buy").removeClass("disabled"),$("#buy-modal .modal-body").find("#ajax-msg").fadeOut(150),alert("ERROR")}})}),$(".add-to-cart").unbind("click"),$(".add-to-cart").click(function(a){a.preventDefault();$(this).attr("data-item-id");var t=$.cookie("cart");if("object"!=typeof t||void 0===t)var e=[];else e=t;console.log(e);var i=$(this).attr("data-item-id"),l=$("input[name='quantity']").val();void 0===l&&(l="1");var o=d.name,r=d.price;e.push({item_id:i,quantity:l,item_name:o,item_price:r}),console.log(e),$.cookie("cart",e),$(this).html(ADDED_TO_CART_MSG),$(this).addClass("disabled"),$(this).attr("disabled","disabled"),refreshCart()})}else $(this).html(a.html).fadeIn("250")})},error:function(a){$("#buy-modal").modal("hide")}})}),$(window).load(function(){refreshCart(),$("#cart-modal .modal-footer #buy-cart").click(function(a){0==$("#cart-modal .modal-body").find("#ajax-msg").length&&$("#cart-modal .modal-body").prepend('<div id="ajax-msg"></div>'),$("#buy-cart").attr("disabled",!0),$("#buy-cart").addClass("disabled"),$("#cart-modal .modal-body").find("#ajax-msg").html('<div class="alert alert-info">'+LOADING_MSG+"...</div>").fadeIn("150");var t=$.cookie("cart"),d={};d.items=t,d.code=$("#cart-voucher").val(),d["data[_Token][key]"]=CSRF_TOKEN,$.ajax({url:BUY_URL,data:d,type:"post",dataType:"JSON",success:function(a){a.statut?($("#buy-cart").attr("disabled",!1),$("#buy-cart").removeClass("disabled"),$.cookie("cart",[]),refreshCart(),0==$("#cart-modal .modal-body").find("#ajax-msg").length&&$("#cart-modal .modal-body").prepend('<div id="ajax-msg"></div>'),$("#cart-modal .modal-body").find("#ajax-msg").html('<div class="alert alert-success">'+a.msg+"</div>").fadeIn("150")):($("#buy-cart").attr("disabled",!1),$("#buy-cart").removeClass("disabled"),$("#cart-modal .modal-body").find("#ajax-msg").html('<div class="alert alert-danger">'+a.msg+"</div>").fadeIn("150"))},error:function(a){$("#buy-cart").attr("disabled",!1),$("#buy-cart").removeClass("disabled"),$("#cart-modal .modal-body").find("#ajax-msg").fadeOut(150),alert("ERROR")}})})});